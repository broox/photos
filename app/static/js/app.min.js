function buildQueryString(e){const t=encodeURIComponent;return Object.keys(e).map(s=>t(s)+"="+t(e[s])).join("&")}function getBrowserWidth(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)}function getBrowserHeight(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)}function isLargeViewport(){return getBrowserWidth()>500}function serializeForPhotoSwipe(e){const t=isLargeViewport()?e.images.medium:e.images.small;let s=e.images.medium;return e.images.large&&(s=e.images.large),{id:e.id,src:s,w:e.width,h:e.height,msrc:t,title:e.description,thumbnail:t}}const photosMixin={data:{album:null,albums:[],fullSearch:!1,limit:40,photos:[],offset:0,pageText:null,photoRowHeight:200,searchInput:null,searchTerm:null,totalPhotoCount:0},created(){isLargeViewport()&&(this.photoRowHeight=300)},computed:{showRealtimeSearchResults(){return this.albums.length>0}},methods:{addPhotosToGallery(e){const t=e.map(serializeForPhotoSwipe);this.photos.push(...t)},clearAlbum(){return this.album=null,this.resetPage(),this.loadPhotos()},clearRealtimeSearchResults(){this.albums=[]},clearSearch(){this.searchTerm=null},clearSearchForm(){return this.searchInput=null,this.clearRealtimeSearchResults(),this.clearSearch(),this.resetPage(),this.loadPhotos()},fetchPhotos(){this.message="Loading...";const e={limit:this.limit,offset:this.offset};return this.album&&(e.album_id=this.album.id),this.searchTerm&&(e.search=this.searchTerm),fetch("/api/v1/photos?"+buildQueryString(e)).then(e=>e.json()).then(e=>{const t=e.data;this.totalPhotoCount=e.meta.count,this.addPhotosToGallery(t),this.message=null}).catch(e=>{this.message="Error loading photos",console.error("Error fetching photos")})},loadPhotos(){return this.updateGalleryURL(),this.fetchPhotos().then(()=>{this.renderGallery(),this.setupSlideShow()})},loadMorePhotos(){if(this.offset=this.offset+this.limit,!(this.offset>=this.totalPhotoCount))return this.loadPhotos()},realtimeSearch(e){this.lastSearchTerm!=this.searchInput&&(this.searchInput.length>2&&"Enter"!==e.key?(this.searchAlbums(this.searchInput),this.lastSearchTerm=this.searchInput):this.clearRealtimeSearchResults())},renderGallery(){new flexImages({selector:".flex-images",rowHeight:this.photoRowHeight}),this.offset<this.totalPhotoCount&&window.addEventListener("scroll",this.infiniteScroll)},resetPage(){this.pageText=null,this.photos=[],this.offset=0,this.totalPhotoCount=0,window.scrollTo(0,0)},searchAlbums(e){this.message="Loading...";const t=e;return fetch("/api/v1/albums?"+buildQueryString({limit:15,search:e})).then(e=>e.json()).then(s=>{if(this.fullSearch||t!==e)return;const o=s.data;this.albums=o,this.message=null}).catch(e=>{this.message="Error loading albums",console.error("Error fetching albums")})},searchPhotos(){this.clearRealtimeSearchResults(),this.resetPage(),this.searchTerm=this.searchInput,this.fullSearch=!0,this.loadPhotos().then(()=>{this.fullSearch=!1})},selectAlbum(e){return this.album=e,this.clearSearch(),this.resetPage(),this.album.description&&(this.pageText=this.album.description),this.loadPhotos()},setupSlideShow(){const e=document.querySelectorAll(".item");for(let t=e.length;t--;)e[t].onclick=this.openSlideShow},syncSearchForm(){this.searchInput!==this.searchTerm&&(this.searchInput=this.searchTerm)},updateGalleryURL(){let e=window.location.origin,t="Broox Photos";if(this.album&&(e+="/"+this.album.slug,t=this.album.title),this.searchTerm){const s=encodeURIComponent(this.searchTerm);e+="/search/"+s,t=s}document.title=t,document.location!==e&&window.history.replaceState({id:t},t,e)},openSlideShow(e){e.preventDefault();const t=document.querySelectorAll(".pswp")[0],s={index:parseInt(e.currentTarget.dataset.index,10),getThumbBoundsFn:function(e){var t=document.querySelectorAll(".item img")[e],s=window.pageYOffset||document.documentElement.scrollTop,o=t.getBoundingClientRect();return{x:o.left,y:o.top+s,w:o.width}},shareButtons:[{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}]};isNaN(s.index)||new PhotoSwipe(t,PhotoSwipeUI_Default,this.photos,s).init()},infiniteScroll(){const e=document.documentElement.offsetHeight;document.documentElement.scrollTop+window.innerHeight+10*this.photoRowHeight>=e&&(this.loadMorePhotos(),window.removeEventListener("scroll",this.infiniteScroll))}}},app=new Vue({el:"#app",data:{message:null},mixins:[photosMixin]}),header=document.getElementById("pageHeader"),sticky=header.offsetTop;window.onscroll=()=>{window.pageYOffset>sticky?header.classList.add("sticky"):header.classList.remove("sticky")},document.onkeydown=e=>{"Escape"===e.key&&app.clearRealtimeSearchResults()};