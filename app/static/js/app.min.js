function buildQueryString(e){const t=encodeURIComponent;return Object.keys(e).map(o=>t(o)+"="+t(e[o])).join("&")}function getBrowserWidth(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)}function getBrowserHeight(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)}function isLargeViewport(){return getBrowserWidth()>500}function serializeForPhotoSwipe(e){const t=isLargeViewport()?e.images.medium:e.images.small;let o=e.images.medium;return e.images.large&&(o=e.images.large),{id:e.id,src:o,w:e.width,h:e.height,msrc:t,title:e.description,thumbnail:t}}const photosMixin={data:{album:null,albums:[],photos:[],offset:0,limit:40,photoRowHeight:200,searchTerm:null,searching:!1,totalPhotoCount:0},created(){isLargeViewport()&&(this.photoRowHeight=300)},methods:{loadPhotos(){this.updateGalleryURL(),this.getRecentPhotos().then(()=>{this.renderGallery(),this.setupSlideShow()})},updateGalleryURL(){let e=window.location.origin,t="Broox Photos";if(this.album&&(e+="/"+this.album.slug,t=this.album.title),this.searchTerm){const o=encodeURIComponent(this.searchTerm);e+="/search/"+o,t=o}document.title=t,window.history.pushState({id:t},t,e)},getRecentPhotos(){this.message="Loading...";const e={limit:this.limit,offset:this.offset};return this.album&&(e.album_id=this.album.id),this.searchTerm&&(e.search=this.searchTerm),fetch("/api/v1/photos?"+buildQueryString(e)).then(e=>e.json()).then(e=>{const t=e.data;this.totalPhotoCount=e.meta.count,this.addPhotosToGallery(t),this.message=null}).catch(e=>{this.message="Error loading photos",console.error("Error fetching photos")})},getMorePhotos(){this.offset=this.offset+this.limit,this.offset>=this.totalPhotoCount||this.loadPhotos()},renderGallery(){new flexImages({selector:".flex-images",rowHeight:this.photoRowHeight}),window.addEventListener("scroll",this.infiniteScroll)},addPhotosToGallery(e){var t=e.map(serializeForPhotoSwipe);this.photos.push(...t)},resetPage(){this.albums=[],this.photos=[],this.offset=0,this.totalPhotoCount=0,window.scrollTo(0,0)},clearAlbum(){this.album=null,this.resetPage(),this.loadPhotos()},clearSearch(){this.searching=!1,this.searchTerm=null,this.resetPage(),this.loadPhotos()},realtimeSearch(){this.searchTerm.length>2&&this.searchAlbums()},searchAlbums(){this.message="Loading...";const e={limit:15,search:this.searchTerm};return console.log("search for albums",e),fetch("/api/v1/albums?"+buildQueryString(e)).then(e=>e.json()).then(e=>{if(this.searching)return;const t=e.data;this.albums=t,this.message=null}).catch(e=>{this.message="Error loading albums",console.error("Error fetching albums")})},searchPhotos(){this.resetPage(),this.loadPhotos(),this.searching=!0},selectAlbum(e){this.album=e,this.clearSearch()},setupSlideShow(){const e=document.querySelectorAll(".item");for(let t=e.length;t--;)e[t].onclick=this.openSlideShow},openSlideShow(e){e.preventDefault();const t=document.querySelectorAll(".pswp")[0],o={index:parseInt(e.currentTarget.dataset.index,10),getThumbBoundsFn:function(e){var t=document.querySelectorAll(".item img")[e],o=window.pageYOffset||document.documentElement.scrollTop,s=t.getBoundingClientRect();return{x:s.left,y:s.top+o,w:s.width}},shareButtons:[{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}]};isNaN(o.index)||new PhotoSwipe(t,PhotoSwipeUI_Default,this.photos,o).init()},infiniteScroll(){const e=document.documentElement.offsetHeight;document.documentElement.scrollTop+window.innerHeight+10*this.photoRowHeight>=e&&(this.getMorePhotos(),window.removeEventListener("scroll",this.infiniteScroll))}}},app=new Vue({el:"#app",data:{message:null},mixins:[photosMixin]}),header=document.getElementById("pageHeader"),sticky=header.offsetTop;window.onscroll=()=>{window.pageYOffset>sticky?header.classList.add("sticky"):header.classList.remove("sticky")};