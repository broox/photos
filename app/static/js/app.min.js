function buildQueryString(t){const e=encodeURIComponent;return Object.keys(t).map(o=>e(o)+"="+e(t[o])).join("&")}function getBrowserWidth(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)}function getBrowserHeight(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)}function isLargeViewport(){return getBrowserWidth()>500}function serializeForPhotoSwipe(t){const e=isLargeViewport()?t.images.medium:t.images.small;let o=t.images.medium;return t.images.large&&(o=t.images.large),{id:t.id,src:o,w:t.width,h:t.height,msrc:e,title:t.description,thumbnail:e}}const photosMixin={data:{album:null,albums:[],photos:[],offset:0,limit:40,pageText:null,photoRowHeight:200,searchTerm:null,searching:!1,totalPhotoCount:0},created(){isLargeViewport()&&(this.photoRowHeight=300)},methods:{loadPhotos(){this.updateGalleryURL(),this.getRecentPhotos().then(()=>{this.renderGallery(),this.setupSlideShow()})},updateGalleryURL(){let t=window.location.origin,e="Broox Photos";if(this.album&&(t+="/"+this.album.slug,e=this.album.title),this.searchTerm){const o=encodeURIComponent(this.searchTerm);t+="/search/"+o,e=o}document.title=e,window.history.pushState({id:e},e,t)},getRecentPhotos(){this.message="Loading...";const t={limit:this.limit,offset:this.offset};return this.album&&(t.album_id=this.album.id),this.searchTerm&&(t.search=this.searchTerm),fetch("/api/v1/photos?"+buildQueryString(t)).then(t=>t.json()).then(t=>{const e=t.data;this.totalPhotoCount=t.meta.count,this.addPhotosToGallery(e),this.message=null}).catch(t=>{this.message="Error loading photos",console.error("Error fetching photos")})},getMorePhotos(){this.offset=this.offset+this.limit,this.offset>=this.totalPhotoCount||this.loadPhotos()},renderGallery(){new flexImages({selector:".flex-images",rowHeight:this.photoRowHeight}),window.addEventListener("scroll",this.infiniteScroll)},addPhotosToGallery(t){var e=t.map(serializeForPhotoSwipe);this.photos.push(...e)},resetPage(){this.albums=[],this.pageText=null,this.photos=[],this.offset=0,this.totalPhotoCount=0,window.scrollTo(0,0)},clearAlbum(){this.album=null,this.resetPage(),this.loadPhotos()},clearSearch(){this.searching=!1,this.searchTerm=null,this.resetPage(),this.loadPhotos()},realtimeSearch(){this.searchTerm.length>2?this.searchAlbums():this.albums=[]},searchAlbums(){this.message="Loading...";const t={limit:15,search:this.searchTerm};return fetch("/api/v1/albums?"+buildQueryString(t)).then(t=>t.json()).then(t=>{if(this.searching)return;const e=t.data;this.albums=e,this.message=null}).catch(t=>{this.message="Error loading albums",console.error("Error fetching albums")})},searchPhotos(){this.resetPage(),this.loadPhotos(),this.searching=!0},selectAlbum(t){this.album=t,this.clearSearch(),this.album.description&&(this.pageText=this.album.description)},setupSlideShow(){const t=document.querySelectorAll(".item");for(let e=t.length;e--;)t[e].onclick=this.openSlideShow},openSlideShow(t){t.preventDefault();const e=document.querySelectorAll(".pswp")[0],o={index:parseInt(t.currentTarget.dataset.index,10),getThumbBoundsFn:function(t){var e=document.querySelectorAll(".item img")[t],o=window.pageYOffset||document.documentElement.scrollTop,s=e.getBoundingClientRect();return{x:s.left,y:s.top+o,w:s.width}},shareButtons:[{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}]};isNaN(o.index)||new PhotoSwipe(e,PhotoSwipeUI_Default,this.photos,o).init()},infiniteScroll(){const t=document.documentElement.offsetHeight;document.documentElement.scrollTop+window.innerHeight+10*this.photoRowHeight>=t&&(this.getMorePhotos(),window.removeEventListener("scroll",this.infiniteScroll))}}},app=new Vue({el:"#app",data:{message:null},mixins:[photosMixin]}),header=document.getElementById("pageHeader"),sticky=header.offsetTop;window.onscroll=()=>{window.pageYOffset>sticky?header.classList.add("sticky"):header.classList.remove("sticky")};